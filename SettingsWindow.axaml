<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:dg="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.DataGrid"
        xmlns:local="clr-namespace:STPTunnel"
        mc:Ignorable="d"
        x:Class="STPTunnel.SettingsWindow"
        x:DataType="local:SettingsVm"
        Width="980" Height="620"
        MinWidth="820" MinHeight="560"
        Title="STPTunnel Settings">

  <Grid Margin="16"
        RowDefinitions="Auto,Auto,*,Auto"
        RowSpacing="12">

    <!-- Header -->
    <StackPanel Spacing="4">
      <TextBlock Text="STPTunnel Settings" FontSize="20" FontWeight="Bold"/>
      <!-- <TextBlock Text="ครั้งแรกให้กรอก Jump Host + เพิ่ม Tunnel แล้วกด Save" Opacity="0.7"/> -->
    </StackPanel>

    <!-- Jump + Profile -->
    <Border Grid.Row="1" Padding="12" CornerRadius="10" BorderThickness="1" BorderBrush="#3A3A3A">
      <Grid ColumnDefinitions="2*,1*,2*,1*" RowDefinitions="Auto,Auto" ColumnSpacing="10" RowSpacing="8">

        <TextBlock Grid.Row="0" Grid.Column="0" Text="Jump Host" FontWeight="Bold"/>
        <TextBlock Grid.Row="0" Grid.Column="1" Text="Port" FontWeight="Bold"/>
        <TextBlock Grid.Row="0" Grid.Column="2" Text="User" FontWeight="Bold"/>
        <TextBlock Grid.Row="0" Grid.Column="3" Text="Profile" FontWeight="Bold"/>

        <TextBox Grid.Row="1" Grid.Column="0"
                 Text="{Binding JumpHost}"
                 Watermark="203.150.100.146"/>

        <TextBox Grid.Row="1" Grid.Column="1"
                 Text="{Binding JumpPort}"
                 Watermark="22"/>

        <TextBox Grid.Row="1" Grid.Column="2"
                 Text="{Binding JumpUser}"
                 Watermark="EEC-e-License"/>

        <ComboBox Grid.Row="1" Grid.Column="3"
                  Width="140"
                  ItemsSource="{Binding ProfileNames}"
                  SelectedItem="{Binding ActiveProfile, Mode=TwoWay}"/>
      </Grid>
    </Border>

    <!-- Tunnels -->
    <Border Grid.Row="2"
            Padding="12"
            CornerRadius="10"
            BorderThickness="1"
            BorderBrush="#3A3A3A">

        <!-- ⭐ ต้องมี * ตรงกลาง -->
        <Grid RowDefinitions="Auto,*,Auto"
              RowSpacing="10">

            <TextBlock Text="Tunnels (LocalPort -> RemoteHost:RemotePort)"
                      FontWeight="Bold"/>

            <!-- ⭐ DataGrid ต้องอยู่ใน row * -->
            <dg:DataGrid x:Name="TunnelsGrid"
                        Grid.Row="1"
                        MinHeight="260"
                        ItemsSource="{Binding Tunnels}"
                        SelectedItem="{Binding SelectedTunnel, Mode=TwoWay}"
                        AutoGenerateColumns="False"
                        IsReadOnly="False"
                        GridLinesVisibility="All"
                        HeadersVisibility="All"
                        RowHeight="34"
                        Background="#111111"
                        Foreground="White"
                        BorderBrush="#3A3A3A"
                        BorderThickness="1">

                <dg:DataGrid.Columns>
                    <dg:DataGridCheckBoxColumn Header="On"
                                              Binding="{Binding Enabled}"
                                              Width="60"/>

                    <dg:DataGridTextColumn Header="Name"
                                          Binding="{Binding Name}"
                                          Width="220"/>

                    <dg:DataGridTextColumn Header="Local Port"
                                          Binding="{Binding LocalPort}"
                                          Width="120"/>

                    <dg:DataGridTextColumn Header="Remote Host"
                                          Binding="{Binding RemoteHost}"
                                          Width="*"/>

                    <dg:DataGridTextColumn Header="Remote Port"
                                          Binding="{Binding RemotePort}"
                                          Width="120"/>
                </dg:DataGrid.Columns>
            </dg:DataGrid>

            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        Spacing="10">
                <Button Content="+ Add" Click="OnAdd"/>
                <Button Content="- Remove" Click="OnRemove"/>
                <Button Content="Open Config Folder" Click="OnOpenConfig"/>

                <Border Width="1" Background="#3A3A3A" Margin="6,0"/>

                <Button Content="Generate SSH Key" Click="OnGenKey"/>
                <Button Content="Copy Public Key" Click="OnCopyPubKey"/>
                <Button Content="Install Public Key → Jump Host" Click="OnInstallKey"/>
                <Button Content="Test SSH" Click="OnTestSsh"/>
            </StackPanel>

        </Grid>
    </Border>

    <!-- Footer -->
    <Grid Grid.Row="3" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
      <TextBlock Text="{Binding StatusText}" Opacity="0.7" VerticalAlignment="Center"/>
      <Button Grid.Column="1" Content="Save" Click="OnSave"/>
      <Button Grid.Column="2" Content="Close" Click="OnClose"/>
    </Grid>

  </Grid>
</Window>